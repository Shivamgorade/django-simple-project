<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ABS10M Inspection Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #e0e7ff, #f0f5ff);
      color: #333;
    }

    header {
      background: linear-gradient(90deg, #1e3c72, #2a5298);
      color: white;
      padding: 1.5rem;
      text-align: center;
      font-size: 2rem;
      font-weight: 700;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      letter-spacing: 0.5px;
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }

    /* Filter Container */
.filters {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  margin-bottom: 2rem;
  align-items: center;
  background: #ffffff;
  padding: 1rem 1.2rem;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  border: 1px solid #e4e7eb;
}

/* Inputs & Selects */
.filters input,
.filters select {
  flex: 1;
  min-width: 180px;
  padding: 0.75rem 0.9rem;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background-color: #f9fafb;
  font-size: 0.95rem;
  font-weight: 500;
  color: #111827;
  transition: all 0.25s ease;
  appearance: none;
}

/* Focus State */
.filters input:focus,
.filters select:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
  background-color: #ffffff;
}

/* Date Placeholder Hack */
#filter-date {
  position: relative;
}

#filter-date::before {
  font-family: 'Inter', sans-serif;
  content: attr(data-placeholder);
  color: #9ca3af;
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
}

#filter-date:valid::before {
  content: "";
}

/* Button Styling */
#apply-filters {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color: white;
  padding: 10px 22px;
  font-size: 0.95rem;
  font-weight: 600;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
}

#apply-filters:hover {
  background: linear-gradient(135deg, #2367ddee, #1e40af);
  transform: translateY(-1px);
}

#apply-filters:active {
  transform: scale(0.97);
}

/* Small Screen Adjustments */
@media (max-width: 600px) {
  .filters {
    padding: 0.8rem;
    gap: 0.8rem;
  }
  
  .filters input,
  .filters select {
    min-width: 100%;
    flex: unset;
  }
}

#filter-date {
  padding-left: 110px; /* space for your label */
  position: relative;
  color: black; /* hides the default mm/dd/yyyy text */
}

#filter-date::before {
  content: "Select Date-";
  color: #000000ff; /* light gray placeholder color */
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
}

/* Remove placeholder when a date is picked */
#filter-date:valid::before {
  content: "";
  color: initial;
}
    .section-title {
      font-size: 1.4rem;
      font-weight: 600;
      margin: 2rem 0 1.5rem;
      color: #1e3c72;
    }

    .summary {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .summary-card {
      
      flex: 1;
      min-width: 220px;
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .summary-card:hover {
      transform: translateY(-5px);
    }

    .summary-card strong {
      display: block;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      color: #444;
    }

    .summary-card p {
      font-size: 1.8rem;
      font-weight: bold;
      color: #1e3c72;
      margin: 0;
    }
    .axis-note{
       color: #1e3c72;
       font-size: 0.7rem;
    }

   
    //-------------------style for the chart 

.chart-container {
  height: 250px;
  position: relative;
}

.subtitle {
  font-size: 0.85rem;
  color: #555;
  margin-bottom: 10px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 24px;
}
.info-card {
  background: white;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(72, 85, 99, 0.1);
  padding: 10px 16px;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 14px;
  border-left: 4px solid #6366f1;
  margin: 16px 0;
  font-size: 13px;
  line-height: 1.2;
}

.info-field {
  display: flex;
  align-items: center;
  gap: 6px;
  background-color: #f1f5ff;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  color: #1e293b;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.04);
  white-space: nowrap;
}

.info-label {
  background-color: #6366f1;
  color: #ffffff;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 3px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.4px;
}

.info-value {
  color: #0f172a;
  font-weight: 600;
  font-size: 13px;
}

@media (max-width: 768px) {
  .info-card {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
}
.info-title {
  width: 100%;
  font-size: 14px;
  font-weight: 700;
  color: #4f46e5;
  margin-bottom: 6px;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.info-subtitle {
  font-size: 11px;
  color: rgba(0, 0, 0, 0.5); /* low opacity */
  font-weight: 400;
  margin-top: 2px;
}
.card {
  
  position: relative;
  background: #fff;
  padding: 16px;
  padding-bottom: 30px;   /* Reserve space for notation */
  border-radius: 16px;
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.06);
  text-align: center;
  
}

.card h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 700;
   color: #1e3c72;
}

.card p {
  margin-top: 4px;
  font-size: 12px;
  color: #555;
}

.chart-container {
  position: relative;
  height: 220px;  /* Best-fit height inside card */
  margin-top: 10px;
  margin-bottom: 10px;
  
}

.notation {
  position: absolute;
  bottom: 20px;
  left: 0;
  right: 0;
  font-size: 11px;
  color: #1e3c72;
  display: flex;
  justify-content: center;
  gap: 16px;
  user-select: none;
}

.notation div {
  display: flex;
  align-items: center;
  gap: 4px;
}

.circle {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  display: inline-block;
}

.circle.red { background-color: red; }
.circle.green { background-color: green; }


  </style>
</head>

<body>
  <header>ðŸ“‹ ABS10M First Piece Inspection Dashboard</header>
  <div class="container">

    <!-- Filter Section -->
   <div class="filters">
   <input type="date" id="filter-date" required>
    <select id="filter-line">
      <option disabled selected>Line No</option>
      <option value="10M LINE#01">10M LINE#01</option>
     <option value="10M LINE#02">10M LINE#02</option>
     <option value="10M LINE#03">10M LINE#03</option>
    </select>
    <select id="filter-shift">
      <option disabled selected>Shift</option>
       <option value="1st">1st[12:00-07:00]</option>
  <option value="2nd">2nd[07:00-3:30]</option>
  <option value="3rd">3rd[03:30-12:00]</option>
    </select>
    <button id="apply-filters">Search</button>
  </div>


    <!-- Summary Section -->
    <div class="section-title">Inspection Summary</div>
   
    <div class="summary">
      <div class="summary-card">
        <strong>ðŸ“Š Total Inspections</strong>
       <p id="total-inspections-count">0</p>
      </div>
      <div class="summary-card">
        <strong>âœ… Total Verified by MFQ</strong>
        <p>400</p>
      </div>
      <div class="summary-card">
        <strong>ðŸ•’ Under MFQ Review</strong>
        <p>500</p>
      </div>
    </div>

    <script>
  async function loadTotalInspections() {
    try {
      const res = await fetch('/api/total-inspections/');
      const data = await res.json();

      if (res.ok && data.total !== undefined) {
        document.getElementById('total-inspections-count').textContent = data.total;
      } else {
        console.warn("Unable to load total inspections count");
      }
    } catch (err) {
      console.error("Error loading inspection count:", err);
    }
  }

  // Call on page load
  loadTotalInspections();
</script>

    <!-- Charts Section -->
    
    <div class="section-title">Visual Analysis Inspection Station Wise</div>


  <div class="info-card">
  <div class="info-title">
    General Info
    <div class="info-subtitle">x-axis staking positions | y-axis staking depth in mm</div>
  </div>

  <div class="info-field">
    <div class="info-label">Date</div>
    <div class="info-value" id="info-date"></div>
  </div>

  <div class="info-field">
    <div class="info-label">Line No</div>
    <div class="info-value" id="info-line"></div>
  </div>

  <div class="info-field">
    <div class="info-label">Shift</div>
    <div class="info-value" id="info-shift"></div>
  </div>

  <div class="info-field">
    <div class="info-label">Supervisor</div>
    <div class="info-value" id="info-supervisor"></div>
  </div>

  <div class="info-field">
    <div class="info-label">Part No</div>
    <div class="info-value" id="info-part-no"></div>
  </div>

  <div class="info-field">
    <div class="info-label">Part Type</div>
    <div class="info-value" id="info-part-type"></div>
  </div>

  <div class="info-field">
    <div class="info-label">ST-15 DMC</div>
    <div class="info-value" id="info-st15-dmc"></div>
  </div>

  <div class="info-field">
    <div class="info-label">ST-30 DMC</div>
    <div class="info-value" id="info-st30-dmc"></div>
  </div>

  <div class="info-field">
    <div class="info-label">Checked By</div>
    <div class="info-value" id="info-checked-by"></div>
  </div>
</div>

<!-- =================== JavaScript =================== -->
<script>
  async function updateInfoCard(date, line, shift) {
    try {
      const res = await fetch(`/api/info-card-data/?date=${encodeURIComponent(date)}&line=${encodeURIComponent(line)}&shift=${encodeURIComponent(shift)}`);
      const data = await res.json();

      if (!res.ok) throw new Error(data.error || "Failed to load card data");

      document.getElementById("info-date").textContent = data["DATE"] || "-";
      document.getElementById("info-line").textContent = data["LINE NO"] || "-";
      document.getElementById("info-shift").textContent = data["SHIFT"] || "-";
      document.getElementById("info-supervisor").textContent = data["SUPERVISOR"] || "-";
      document.getElementById("info-part-no").textContent = data["PART NO"] || "-";
      document.getElementById("info-part-type").textContent = data["PART TYPE"] || "-";
      document.getElementById("info-st15-dmc").textContent = data["ST-15 DMC NO"] || "-";
      document.getElementById("info-st30-dmc").textContent = data["ST-30 DMC NO"] || "-";
      document.getElementById("info-checked-by").textContent = data["CHECKED BY"] || "-";
    } catch (err) {
      console.error("Info Card Error:", err.message);
    }
  }

  // Call this after applying filters:
  updateInfoCard(date, line, shift);
</script>

   <div class="grid">

    <!-- ST-15 Chart -->
   <div class="card">
  <h2>ST-15 Accumulator Cap</h2>
  <p class="subtitle"></p>
  <div class="chart-container" style="height: 240px;">
    <canvas id="chart1"></canvas>
  </div>
  <div class="notation">
    <div><span class="circle red"></span> Spec Range: 0.75 - 1.45 mm</div>
    <div><span class="circle green"></span> Control Limit: 0.80 - 1.40 mm</div>
  </div>
</div>

    <!-- Staking Measurement -->
    <div class="card">
  <h2>ST-20 Ball Staking</h2>
  <p class="subtitle"> </p>
  <div class="chart-container" style="height: 260px;">
    <canvas id="chart2"></canvas>
  </div>
  <div class="notation">
    <div><span class="circle red"></span> Spec Range: 0.50 - 0.85 mm</div>
    <div><span class="circle green"></span> Control Limit: 0.55 - 0.80 mm</div>
  </div>
</div>


    <!-- ST-25 Gauge Chart -->
   <div class="card">
  <h2>ST-25 C-Bearing</h2>
 
  <div class="chart-container">
    <canvas id="chart3"></canvas>
  </div>
  <div class="notation">
    <div><span class="circle red"></span> 0.20 - 0.60 mm</div>
    <div><span class="circle green"></span> 0.30 - 0.45 mm</div>
  </div>
</div>

    <!-- MV Staking Chart -->
<div class="card">
  <h2>ST-25 MV Staking</h2>
 
  
  <!-- Chart Container -->
  <div class="chart-container" style="height: 250px;">
    <canvas id="chart4"></canvas>
  </div>

  <!-- Notation -->
  <div class="notation">
    <div><span class="circle red"></span> Spec Range: 0.65 - 0.90 mm</div>
    <div><span class="circle green"></span> Control Limit: 0.70 - 0.85 mm</div>
  </div>
</div>


<div class="card">
  <h2>ST-30 â€“ Motor Staking</h2>
 
  <div class="chart-container" style="height: 280px;">
    <canvas id="st30Chart"></canvas>
  </div>
  <div class="notation">
    <div><span class="circle red"></span> Spec Range: 0.50 - 1.40 mm</div>
    <div><span class="circle green"></span> Control Limit: 0.65 - 1.30 mm</div>
  </div>
</div>



<div class="card">
  <h2>ST-40 AV Staking</h2>
 
  <div class="chart-container" style="position: relative; height: 280px; width: 100%;">
    <canvas id="chart6"></canvas>
  </div>
  <div class="notation">
    <div><span class="circle red"></span> Spec Range:0.37 - 0.60 mm</div>
    <div><span class="circle green"></span> Control Limit:0.40 - 0.56 mm</div>
  </div>
</div>
  </div>
 <style>
   

    .card-container-custom {
      background: #ffffffff;
      border-left: 6px solid #4f46e5;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 12px 0px;
    }

    .card-section-custom {
      flex: 1 1 300px;
    }

    .card-header-custom {
      font-size: 16px;
      font-weight: 600;
      color: #4f46e5;
      margin-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 4px;
    }

    .field-box-custom {
      display: flex;
      align-items: center;
      gap: 6px;
      background-color: #f3f4f6;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      color: #1f2937;
      margin-bottom: 8px;
      white-space: nowrap;
    }

    .field-label-custom {
      font-weight: 600;
      color: #374151;
    }

    .status-ok-custom {
      background-color: #d1fae5;
      color: #065f46;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
    }

    .status-nok-custom {
      background-color: #fee2e2;
      color: #991b1b;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .card-container-custom {
        flex-direction: column;
        gap: 16px;
      }
    }
  </style>


<!-- ST-45 Section -->
<div class="card-container-custom">
  <div class="card-section-custom">
    <div class="card-header-custom">ST-45 Torquing ECU Screws</div>
    <div class="field-box-custom">
      <div class="field-label-custom">231:</div>
      <div id="status-231" class="status-ok-custom">Loading...</div>
    </div>
    <div class="field-box-custom">
      <div class="field-label-custom">232:</div>
      <div id="status-232" class="status-ok-custom">Loading...</div>
    </div>
    <div class="field-box-custom">
      <div class="field-label-custom">No Damage to Head of ECU Screws After Torquing:</div>
      <div id="status-ecu-screws" class="status-ok-custom">Loading...</div>
    </div>
  </div>

  <!-- ST-85 Section -->
  <div class="card-section-custom">
    <div class="card-header-custom">ST-85 Tape Application</div>
    <div class="field-box-custom">
      <div class="field-label-custom">No Damage to ECU Housing (Pins of Customer Connector):</div>
      <div id="status-ecu-housing" class="status-ok-custom">Loading...</div>
    </div>
  </div>
</div>

<script>
  async function updateInspectionCard(date, line, shift) {
    try {
      const res = await fetch(`/api/st45-st85-data/?date=${encodeURIComponent(date)}&line=${encodeURIComponent(line)}&shift=${encodeURIComponent(shift)}`);
      const data = await res.json();

      if (!res.ok) throw new Error(data.error || "Failed to load inspection data");

      const fieldMapping = {
        "231": "status-231",
        "232": "status-232",
        "No Damage to Head of ECU Screws After Torquing": "status-ecu-screws",
        "No Damage to ECU Housing (Pins of Customer Connector)": "status-ecu-housing"
      };

      Object.keys(fieldMapping).forEach(key => {
        const elementId = fieldMapping[key];
        const el = document.getElementById(elementId);

        if (el) {
          const value = data[key] || "-";
          el.textContent = value;

          // Remove existing status classes
          el.classList.remove("status-ok-custom", "status-nok-custom", "status-na-custom");

          // Add based on value
          if (value.toLowerCase() === "ok") el.classList.add("status-ok-custom");
          else if (value.toLowerCase() === "nok") el.classList.add("status-nok-custom");
          else el.classList.add("status-na-custom");
        }
      });
    } catch (err) {
      console.error("ST45-ST85 Card Update Error:", err.message);
    }
  }
</script>






  </div>

  <script>
 // ------------------------------
// COMMON FILTER BUTTON HANDLER
// ------------------------------

document.getElementById("apply-filters").addEventListener("click", () => {
  const date = document.getElementById("filter-date").value;
  const line = document.getElementById("filter-line").value;
  const shift = document.getElementById("filter-shift").value;

  if (date && line && shift) {
    fetchST15Chart(date, shift, line);
    fetchST20Chart(date, shift, line);
    updateST25CChart(date, line, shift);  // Call this chart function
    updateST25MVChart(date, line, shift);
    updateST30Chart(date, line, shift);
    updateST40Chart(date, line, shift);
    updateInfoCard(date, line, shift);
    updateInspectionCard(date, line, shift);  // ðŸ‘ˆ Ensure this is calle
 
   
    
  } else {
    alert("Please select all filters.");
  }
});

    // CHART 1 - ST-15----------------------------------------------------------------------

// ------------------------------
// CHART 1 - ST-15 Configuration
// ------------------------------

let st15Chart = null;

function renderST15Chart(labels, data) {
  const ctx1 = document.getElementById("chart1").getContext("2d");

  if (st15Chart) st15Chart.destroy();

  const grad1 = ctx1.createLinearGradient(0, 0, 0, 300);
  grad1.addColorStop(0, "#36d1dc");
  grad1.addColorStop(1, "#5b86e5");

  const plugin1 = {
    id: "bg1",
    beforeDatasetsDraw(chart) {
      const { ctx, chartArea: { left, right }, scales: { y } } = chart;
      ctx.save();

      // Red zone (spec limits)
      ctx.fillStyle = "rgba(255, 0, 0, 0.1)";
      ctx.fillRect(left, y.getPixelForValue(1.50), right - left, y.getPixelForValue(0.70) - y.getPixelForValue(1.50));

      // Green zone (control limits)
      ctx.fillStyle = "rgba(0, 128, 0, 0.15)";
      ctx.fillRect(left, y.getPixelForValue(1.4), right - left, y.getPixelForValue(0.8) - y.getPixelForValue(1.4));

      // Dashed spec limit lines
      ctx.setLineDash([5, 5]);
      ctx.lineWidth = 1.5;
      ctx.strokeStyle = "red";
      [0.75, 1.45].forEach(val => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(val));
        ctx.lineTo(right, y.getPixelForValue(val));
        ctx.stroke();
      });

      // Dashed control limit lines
      ctx.strokeStyle = "green";
      [0.8, 1.4].forEach(val => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(val));
        ctx.lineTo(right, y.getPixelForValue(val));
        ctx.stroke();
      });

      ctx.restore();
    }
  };

  st15Chart = new Chart(ctx1, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        data: data,
        backgroundColor: grad1,
        borderRadius: 4,
        barThickness: 35
      }]
    },
    options: {
      plugins: {
        legend: { display: false },
        datalabels: {
          color: "#000",
          anchor: "end",
          align: "top",
          font: { weight: "bold", size: 11 },
          formatter: val => val.toFixed(2)
        },
        tooltip: {
          callbacks: {
            label: ctx => `Depth: ${ctx.parsed.y.toFixed(2)} mm`
          }
        }
      },
      scales: {
        y: {
          min: 0.7,
          max: 1.5,
          ticks: {
            stepSize: 0.05,
            font: { size: 11 },
            callback: val => val.toFixed(2)
          },
          grid: {
            drawTicks: false,
            color: "rgba(0,0,0,0.05)"
          }
        },
        x: {
          grid: { display: false },
          ticks: { font: { size: 11 } }
        }
      },
      responsive: true,
      maintainAspectRatio: false
    },
    plugins: [ChartDataLabels, plugin1]
  });
}

async function fetchST15Chart(date, shift, line) {
  try {
    const res = await fetch(`/api/chart-data/?date=${encodeURIComponent(date)}&shift=${encodeURIComponent(shift)}&line=${encodeURIComponent(line)}`);
    const data = await res.json();

    if (Array.isArray(data.labels) && Array.isArray(data.data)) {
      renderST15Chart(data.labels, data.data);
    }
  } catch (err) {
    console.error("ST-15 Chart Load Error:", err);
  }
}

// âœ… Default dummy values on page load
document.addEventListener("DOMContentLoaded", () => {
  const defaultLabels = ["501", "502"];
  const defaultValues = [1.2, 1.2];  // Within green zone
  renderST15Chart(defaultLabels, defaultValues);
});

// ------------------------------
// CHART 2 - ST-20 Configuration
// ------------------------------
let st20Chart = null;

function renderST20Chart(labels, values) {
  const ctx2 = document.getElementById("chart2").getContext("2d");

  if (st20Chart) st20Chart.destroy();

  const grad2 = ctx2.createLinearGradient(0, 0, 0, 300);
  grad2.addColorStop(0, "#36d1dc");
  grad2.addColorStop(1, "#5b86e5");

  const plugin2 = {
    id: "bg2",
    beforeDatasetsDraw(chart) {
      const { ctx, chartArea: { left, right }, scales: { y } } = chart;
      ctx.save();

      // Spec range (red)
      ctx.fillStyle = "rgba(255, 0, 0, 0.1)";
      ctx.fillRect(left, y.getPixelForValue(0.90), right - left, y.getPixelForValue(0.40) - y.getPixelForValue(0.90));

      // Control range (green)
      ctx.fillStyle = "rgba(0, 128, 0, 0.12)";
      ctx.fillRect(left, y.getPixelForValue(0.80), right - left, y.getPixelForValue(0.55) - y.getPixelForValue(0.80));

      // Dashed spec lines
      ctx.setLineDash([5, 5]);
      ctx.lineWidth = 1.5;
      ctx.strokeStyle = "red";
      [0.50, 0.85].forEach(val => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(val));
        ctx.lineTo(right, y.getPixelForValue(val));
        ctx.stroke();
      });

      // Dashed control lines
      ctx.strokeStyle = "green";
      [0.55, 0.80].forEach(val => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(val));
        ctx.lineTo(right, y.getPixelForValue(val));
        ctx.stroke();
      });

      ctx.restore();
    }
  };

  st20Chart = new Chart(ctx2, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: grad2,
        borderRadius: 4,
        barThickness: 25
      }]
    },
    options: {
      layout: { padding: { top: 0, bottom: 10 } },
      plugins: {
        legend: { display: false },
        datalabels: {
          color: "#000",
          anchor: "end",
          align: "top",
          font: { weight: "bold", size: 11 },
          formatter: val => val.toFixed(2)
        },
        tooltip: {
          callbacks: {
            label: ctx => `Depth: ${ctx.parsed.y.toFixed(2)} mm`
          }
        }
      },
      scales: {
        y: {
          min: 0.4,
          max: 0.9,
          ticks: {
            stepSize: 0.1,
            font: { size: 10 },
            callback: val => val.toFixed(2)
          },
          grid: {
            drawTicks: false,
            color: "rgba(0,0,0,0.05)"
          }
        },
        x: {
          grid: { display: false },
          ticks: { font: { size: 10 } }
        }
      },
      responsive: true,
      maintainAspectRatio: false
    },
    plugins: [ChartDataLabels, plugin2]
  });
}

async function fetchST20Chart(date, shift, line) {
  try {
    const res = await fetch(`/api/chart-data-st20/?date=${encodeURIComponent(date)}&line=${encodeURIComponent(line)}&shift=${encodeURIComponent(shift)}`);
    const data = await res.json();

    if (Array.isArray(data.labels) && Array.isArray(data.values)) {
      renderST20Chart(data.labels, data.values);
    }
  } catch (err) {
    console.error("ST-20 Chart Load Error:", err);
  }
}

// âœ… Load with default dummy data on page load
document.addEventListener("DOMContentLoaded", () => {
  const defaultLabels = ["311", "312", "411", "412", "531", "532", "541", "542"];
  const defaultValues = [0.70, 0.70, 0.70, 0.70, 0.70, 0.70, 0.70, 0.70];  // Good-looking safe values
  renderST20Chart(defaultLabels, defaultValues);
});


    // CHART 3 - ST-25 c -----------------------------------------------------------------------------------


  let chart3Instance = null;

function createST25CChart(value = 0.42) {
  const ctx3 = document.getElementById("chart3").getContext("2d");

  if (chart3Instance) chart3Instance.destroy();

  chart3Instance = new Chart(ctx3, {
    type: "bar",
    data: {
      labels: ["221"],
      datasets: [
        {
          label: "Low",
          data: [0.30],
          backgroundColor: "rgba(255,0,0,0.12)",
          barThickness: 50,
          stack: "s"
        },
        {
          label: "Control",
          data: [0.15],
          backgroundColor: "rgba(0,128,0,0.18)",
          barThickness: 50,
          stack: "s"
        },
        {
          label: "High",
          data: [0.25],
          backgroundColor: "rgba(255,0,0,0.12)",
          barThickness: 50,
          stack: "s"
        },
        {
          label: "Actual",
          type: "line",
          data: [value],
          pointBackgroundColor: "#000",
          pointBorderColor: "#fff",
          pointBorderWidth: 2,
          pointRadius: 8,
          showLine: false
        }
      ]
    },
    options: {
      indexAxis: "y",
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: () => `Depth: ${value.toFixed(2)} mm`
          }
        }
      },
      scales: {
        x: {
          min: 0.20,
          max: 0.65,
          ticks: {
            stepSize: 0.05,
            color: "#555",
            font: { size: 11 }
          },
          grid: {
            drawTicks: true,
            color: "rgba(200,200,200,0.2)"
          }
        },
        y: {
          ticks: { display: false },
          grid: { display: false }
        }
      },
      responsive: true,
      maintainAspectRatio: false
    },
    plugins: [
      {
        id: "labelDot",
        afterDatasetsDraw(chart) {
          const { ctx, chartArea: { top, bottom }, scales: { x } } = chart;
          ctx.save();

          // Draw black dot label
          ctx.fillStyle = "#000";
          ctx.font = "bold 12px Segoe UI";
          ctx.textAlign = "center";
          ctx.fillText(`${value.toFixed(2)} mm`, x.getPixelForValue(value), bottom - 40);

          // Control limit lines (green)
          ctx.beginPath();
          ctx.setLineDash([5, 5]);
          ctx.strokeStyle = "green";
          ctx.lineWidth = 1.5;

          [0.30, 0.45].forEach(val => {
            ctx.moveTo(x.getPixelForValue(val), top);
            ctx.lineTo(x.getPixelForValue(val), bottom);
            ctx.stroke();
          });

          // Spec limit lines (red)
          ctx.strokeStyle = "red";

          [0.20, 0.60].forEach(val => {
            ctx.beginPath();
            ctx.moveTo(x.getPixelForValue(val), top);
            ctx.lineTo(x.getPixelForValue(val), bottom);
            ctx.stroke();
          });

          ctx.restore();
        }
      }
    ]
  });
}

async function updateST25CChart(date, line, shift) {
  try {
    const res = await fetch(`/api/chart-data-st25c/?date=${encodeURIComponent(date)}&line=${encodeURIComponent(line)}&shift=${encodeURIComponent(shift)}`);
    if (!res.ok) throw new Error("Server error");

    const result = await res.json();
    const value = result.values[0]; // Depth from backend
    createST25CChart(value);

  } catch (err) {
    console.error("ST-25-C Chart Load Error:", err);
    alert("NO DATA FOUND FOR THIS DATE ");
  }
}

// âœ… Default dummy value when page loads
document.addEventListener("DOMContentLoaded", () => {
  createST25CChart(0.38); // Default dummy depth
});


    // CHART 4 - ST-25 MV-------------------------------------------------------------------------------
let chartST25MV = null;

function createST25MVChart(labels, values) {
  const ctx4 = document.getElementById('chart4').getContext('2d');

  if (chartST25MV) chartST25MV.destroy();

  const grad4 = ctx4.createLinearGradient(0, 0, 0, 300);
  grad4.addColorStop(0, '#36d1dc');
  grad4.addColorStop(1, '#5b86e5');

  const plugin4 = {
    id: 'bg4',
    beforeDatasetsDraw(chart) {
      const { ctx, chartArea: { left, right }, scales: { y } } = chart;
      ctx.save();

      // Spec Range Background (Red)
      ctx.fillStyle = 'rgba(255, 0, 0, 0.1)';
      ctx.fillRect(left, y.getPixelForValue(0.95), right - left, y.getPixelForValue(0.60) - y.getPixelForValue(0.95));

      // Control Range Background (Green)
      ctx.fillStyle = 'rgba(0, 128, 0, 0.15)';
      ctx.fillRect(left, y.getPixelForValue(0.85), right - left, y.getPixelForValue(0.70) - y.getPixelForValue(0.85));

      // Dashed Lines
      ctx.setLineDash([5, 5]);
      ctx.lineWidth = 1.5;

      // Red Spec Lines
      ctx.strokeStyle = 'red';
      [0.65, 0.90].forEach(v => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(v));
        ctx.lineTo(right, y.getPixelForValue(v));
        ctx.stroke();
      });

      // Green Control Lines
      ctx.strokeStyle = 'green';
      [0.70, 0.85].forEach(v => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(v));
        ctx.lineTo(right, y.getPixelForValue(v));
        ctx.stroke();
      });

      ctx.restore();
    }
  };

  chartST25MV = new Chart(ctx4, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: grad4,
        borderRadius: 4,
        barThickness: 35
      }]
    },
    options: {
      plugins: {
        legend: { display: false },
        datalabels: {
          color: '#000',
          anchor: 'end',
          align: 'top',
          font: { weight: 'bold', size: 11 },
          formatter: val => val.toFixed(2)
        },
        tooltip: {
          callbacks: {
            label: ctx => `Depth: ${ctx.parsed.y.toFixed(2)} mm`
          }
        }
      },
      scales: {
        y: {
          min: 0.6,
          max: 0.95,
          ticks: {
            stepSize: 0.05,
            font: { size: 11 }
          }
        },
        x: {
          grid: { display: false },
          ticks: { font: { size: 11 } }
        }
      },
      responsive: true,
      maintainAspectRatio: false
    },
    plugins: [ChartDataLabels, plugin4]
  });
}

async function updateST25MVChart(date, line, shift) {
  try {
    const url = `/api/chart-data-st25mv/?date=${encodeURIComponent(date)}&line=${encodeURIComponent(line)}&shift=${encodeURIComponent(shift)}`;
    const res = await fetch(url);
    const data = await res.json();

    if (!res.ok) throw new Error(data.message || "Server error");

    createST25MVChart(data.labels, data.values);
  } catch (err) {
    console.error("ST-25-MV Chart Load Error:", err.message || err);
  }
}

// âœ… On DOM ready: show default dummy chart
document.addEventListener("DOMContentLoaded", () => {
  // Default dummy values
  createST25MVChart(["201", "202", "211", "212"], [0.75, 0.75, 0.75, 0.75]);

  // Optional: filter button binding
  const btn = document.getElementById("applyFiltersBtn");
  if (btn) {
    btn.addEventListener("click", () => {
      const date = document.getElementById("filter-date").value;
      const line = document.getElementById("filter-line").value;
      const shift = document.getElementById("filter-shift").value;

      updateST25MVChart(date, line, shift);
    });
  }
});
//st-30------------------------------------------------------------------------------------------------


let chartST30 = null;

function createST30Chart(labels, values) {
  const ctx30 = document.getElementById('st30Chart').getContext('2d');

  if (chartST30) chartST30.destroy();

  const grad30 = ctx30.createLinearGradient(0, 0, 0, 300);
  grad30.addColorStop(0, '#36d1dc');
  grad30.addColorStop(1, '#5b86e5');

  const plugin30 = {
    id: 'bg30',
    beforeDatasetsDraw(chart) {
      const { ctx, chartArea: { left, right }, scales: { y } } = chart;
      ctx.save();

      // Spec range (Red)
      ctx.fillStyle = "rgba(255, 0, 0, 0.1)";
      ctx.fillRect(left, y.getPixelForValue(1.5), right - left, y.getPixelForValue(0.4) - y.getPixelForValue(1.5));

      // Control range (Green)
      ctx.fillStyle = "rgba(0, 128, 0, 0.15)";
      ctx.fillRect(left, y.getPixelForValue(1.3), right - left, y.getPixelForValue(0.65) - y.getPixelForValue(1.3));

      // Dashed lines
      ctx.setLineDash([5, 5]);
      ctx.lineWidth = 1.5;

      ctx.strokeStyle = 'red';
      [0.5, 1.4].forEach(val => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(val));
        ctx.lineTo(right, y.getPixelForValue(val));
        ctx.stroke();
      });

      ctx.strokeStyle = 'green';
      [0.65, 1.3].forEach(val => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(val));
        ctx.lineTo(right, y.getPixelForValue(val));
        ctx.stroke();
      });

      ctx.restore();
    }
  };

  chartST30 = new Chart(ctx30, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Staking Depth (mm)',
        data: values,
        backgroundColor: grad30,
        borderRadius: 4,
        barThickness: 36,
        borderSkipped: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: { top: 5, bottom: 10, left: 10, right: 10 } },
      plugins: {
        legend: { display: false },
        datalabels: {
          color: "#000",
          anchor: 'end',
          align: 'top',
          font: { size: 11, weight: 'bold' },
          formatter: val => val.toFixed(2)
        },
        tooltip: {
          callbacks: {
            label: ctx => `Depth: ${ctx.parsed.y.toFixed(2)} mm`
          }
        }
      },
      scales: {
        y: {
          min: 0.4,
          max: 1.5,
          ticks: {
            stepSize: 0.1,
            font: { size: 11 }
          },
          grid: {
            drawTicks: false,
            color: 'rgba(0,0,0,0.05)'
          }
        },
        x: {
          ticks: { font: { size: 11 } },
          grid: { display: false }
        }
      }
    },
    plugins: [ChartDataLabels, plugin30]
  });
}

// âœ… Fetch and update chart
async function updateST30Chart(date, line, shift) {
  try {
    const res = await fetch(`/api/chart-data-st30/?date=${encodeURIComponent(date)}&line=${encodeURIComponent(line)}&shift=${encodeURIComponent(shift)}`);
    const data = await res.json();

    if (!res.ok) throw new Error(data.message || "Server error");

    createST30Chart(data.labels, data.values);
  } catch (err) {
    console.error("ST-30 Chart Load Error:", err.message || err);
  }
}

// âœ… On DOM ready: Show default dummy chart and bind filter
document.addEventListener("DOMContentLoaded", () => {
  // Dummy data for initial load
  createST30Chart(["222", "223", "224"], [1.03, 1.03, 1.03]);

  // Optional: trigger on filter apply button
  const btn = document.getElementById("applyFiltersBtn");
  if (btn) {
    btn.addEventListener("click", () => {
      const date = document.getElementById("filter-date").value;
      const line = document.getElementById("filter-line").value;
      const shift = document.getElementById("filter-shift").value;

      updateST30Chart(date, line, shift);
    });
  }
});


// st-40----------------------------------------------------------------------------------------------------


let chartST40 = null;

function createST40Chart(labels, values) {
  const ctx6 = document.getElementById("chart6").getContext("2d");

  if (chartST40) chartST40.destroy();

  const grad6 = ctx6.createLinearGradient(0, 0, 0, 300);
  grad6.addColorStop(0, "#36d1dc");
  grad6.addColorStop(1, "#5b86e5");

  const plugin6 = {
    id: "bg6",
    beforeDatasetsDraw(chart) {
      const { ctx, chartArea: { left, right }, scales: { y } } = chart;
      ctx.save();

      // Red (spec zone)
      ctx.fillStyle = "rgba(255, 0, 0, 0.1)";
      ctx.fillRect(left, y.getPixelForValue(0.65), right - left, y.getPixelForValue(0.30) - y.getPixelForValue(0.65));

      // Green (control zone)
      ctx.fillStyle = "rgba(0, 128, 0, 0.15)";
      ctx.fillRect(left, y.getPixelForValue(0.56), right - left, y.getPixelForValue(0.4) - y.getPixelForValue(0.56));

      // Dashed lines
      ctx.setLineDash([5, 5]);
      ctx.lineWidth = 1.5;

      ctx.strokeStyle = "red";
      [0.37, 0.6].forEach(val => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(val));
        ctx.lineTo(right, y.getPixelForValue(val));
        ctx.stroke();
      });

      ctx.strokeStyle = "green";
      [0.4, 0.56].forEach(val => {
        ctx.beginPath();
        ctx.moveTo(left, y.getPixelForValue(val));
        ctx.lineTo(right, y.getPixelForValue(val));
        ctx.stroke();
      });

      ctx.restore();
    },
  };

  chartST40 = new Chart(ctx6, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [
        {
          data: values,
          backgroundColor: grad6,
          borderRadius: 4,
          barThickness: 36,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        datalabels: {
          color: "#000",
          anchor: "end",
          align: "top",
          font: { size: 11, weight: "bold" },
          formatter: (val) => val.toFixed(2),
        },
      },
      scales: {
        y: {
          min: 0.3,
          max: 0.65,
          ticks: {
            stepSize: 0.05,
            font: { size: 11 },
          },
          grid: {
            drawTicks: false,
            color: "rgba(0,0,0,0.05)",
          },
        },
        x: {
          grid: { display: false },
          ticks: { font: { size: 11 } },
        },
      },
    },
    plugins: [ChartDataLabels, plugin6],
  });
}

// âœ… Fetch & Update Chart
async function updateST40Chart(date, line, shift) {
  try {
    const res = await fetch(`/api/chart-data-st40/?date=${encodeURIComponent(date)}&line=${encodeURIComponent(line)}&shift=${encodeURIComponent(shift)}`);
    const data = await res.json();

    if (!res.ok) throw new Error(data.message || "Server error");

    createST40Chart(data.labels, data.values);
  } catch (err) {
    console.error("ST-40 Chart Load Error:", err.message || err);
  }
}

// âœ… Initialize on page load with default values
document.addEventListener("DOMContentLoaded", () => {
  // ðŸŽ¯ Default dummy values (you can change this to match your Excel expected range visually)
  createST40Chart(["301", "401"], [0.50, 0.50]);

  // If using a button or auto-filter trigger:
  const filterBtn = document.getElementById("applyFiltersBtn");
  if (filterBtn) {
    filterBtn.addEventListener("click", () => {
      const date = document.getElementById("filter-date").value;
      const line = document.getElementById("filter-line").value;
      const shift = document.getElementById("filter-shift").value;

      updateST40Chart(date, line, shift);
    });
  }
});




  </script>
</body>

</html>
